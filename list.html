<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Resep</title>
  <style>
    body { font-family:Poppins,sans-serif; margin:20px; background:#f5f5f5; }
    h1 { text-align:center; margin-bottom:20px; }
    .controls { display:flex; gap:10px; justify-content:center; margin-bottom:20px; }
    .controls input { padding:8px 12px; border-radius:8px; border:1px solid #ccc; min-width:240px; }
    .controls button { padding:8px 14px; border:none; border-radius:8px; background:#7b3fe4; color:#fff; cursor:pointer; }
    .list { display:flex; flex-direction:column; gap:15px; }
    .item { display:flex; background:#fff; border-radius:12px; overflow:hidden;
      box-shadow:0 2px 8px rgba(0,0,0,0.1); cursor:pointer; transition:transform 0.2s; }
    .item:hover { transform:translateY(-4px); }
    .item img { width:160px; height:120px; object-fit:cover; }
    .item-content { padding:10px 15px; flex:1; }
    .item-content h2 { margin:0 0 6px; font-size:16px; color:#333; }
    .item-content p { margin:3px 0; font-size:13px; color:#666; }
    a.back { display:inline-block; margin-bottom:15px; color:#7b3fe4; text-decoration:none; }
  </style>
</head>
<body>
  <a href="index.html" class="back">‚Üê Kembali ke Kategori</a>
  <h1 id="title">üç≤ Daftar Resep</h1>

  <!-- Search Bar -->
  <div class="controls">
    <input type="search" id="search" placeholder="Cari resep...">
    <button id="resetBtn">Reset</button>
  </div>

  <div id="recipes" class="list"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const cid = urlParams.get("cid");

    let allRecipes = []; 
    const recipesDiv = document.getElementById("recipes");
    const searchInput = document.getElementById("search");
    const resetBtn = document.getElementById("resetBtn");

    // path dasar untuk hapus prefix file://
    const basePath = "file:///C:/Users/ACER/Documents/Data%20Resep/";

    async function loadList() {
      try {
        const res = await fetch("GDPR.json");
        const data = await res.json();

        const kategori = data.NEWSCATEGORY.find(c => c.cid == cid);
        if (kategori) {
          document.getElementById("title").textContent = `üç≤ Resep ${kategori.category_name}`;
        }

        allRecipes = data.data.filter(r => r.cid == cid);
        renderRecipes(allRecipes);
      } catch (err) {
        console.error("Gagal load JSON:", err);
        recipesDiv.innerHTML = "<p style='color:red'>Gagal memuat data.</p>";
      }
    }

    function renderRecipes(list) {
      recipesDiv.innerHTML = "";
      if (list.length === 0) {
        recipesDiv.innerHTML = "<p>Tidak ada resep ditemukan.</p>";
        return;
      }
      list.forEach(recipe => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <img src="${(recipe.image || '').replace(basePath,'')}" alt="${recipe.judul || ''}">
          <div class="item-content">
            <h2>${recipe.judul || '-'}</h2>
            <p><strong>Kategori:</strong> ${recipe.category_name || ""}</p>
          </div>
        `;
        div.onclick = () => { window.location.href = `detail.html?id=${recipe.id}`; };
        recipesDiv.appendChild(div);
      });
    }

    // Search event
    searchInput.addEventListener("input", () => {
      const q = searchInput.value.toLowerCase();
      const filtered = allRecipes.filter(r => (r.judul || "").toLowerCase().includes(q));
      renderRecipes(filtered);
    });

    // Reset search
    resetBtn.onclick = () => {
      searchInput.value = "";
      renderRecipes(allRecipes);
    };

    loadList();
  </script>
</body>
</html>
