<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cari Resep</title>
<style>
  :root{--bg:#F6FBF7;--accent:#7FCF9B;--muted:#6b7f77}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg)}
  header{background:linear-gradient(90deg,var(--accent),#B8E6C8);padding:14px;color:#033;display:flex;align-items:center;gap:12px}
  header a{color:#033;text-decoration:none;font-weight:700}
  .wrap{max-width:960px;margin:18px auto;padding:14px}
  .searchbox{display:flex;gap:8px;margin-bottom:14px}
  .searchbox input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06)}
  .searchbox button{padding:10px 14px;border:0;border-radius:10px;background:var(--accent);color:#042;font-weight:700}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
  .card{background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 8px 24px rgba(6,36,24,0.06)}
  .card img{width:100%;height:140px;object-fit:cover}
  .card .body{padding:10px}
  .no{padding:30px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <header><a href="index.html">⬅️</a><div style="font-weight:800">Cari Resep</div></header>
  <main class="wrap">
    <div class="searchbox">
      <input id="q" placeholder="Masukkan kata kunci..." />
      <button id="btn">Cari</button>
    </div>
    <div id="list" class="list"></div>
    <div id="no" class="no" style="display:none">Hasil tidak ditemukan.</div>
  </main>

<script>
const DATA_URL = "https://gampil.github.io/resep/resepterbaru/recipes.json";
let tb_recipe = [];

async function load(){
  try{
    const res = await fetch(DATA_URL);
    const data = await res.json();
    tb_recipe = data.tb_recipe || [];
    // inisialisasi q dari param
    const p = new URLSearchParams(location.search).get('q') || '';
    document.getElementById('q').value = p;
    if(p) doSearch(p);
  }catch(e){ console.error(e); document.getElementById('list').innerHTML='<p>Gagal memuat</p>';}
}

function doSearch(q){
  const s = q.trim().toLowerCase();
  const out = tb_recipe.filter(r=>{
    return (r.recipe_name||'').toLowerCase().includes(s) ||
           (r.recipe_ingredient||'').toLowerCase().includes(s) ||
           (r.recipe_instruction||'').toLowerCase().includes(s);
  });
  render(out);
}

function render(list){
  const container = document.getElementById('list');
  container.innerHTML = '';
  if(!list || list.length===0){ document.getElementById('no').style.display='block'; return; }
  document.getElementById('no').style.display='none';
  list.forEach(r=>{
    const c = document.createElement('article'); c.className='card';
    c.innerHTML = `<img src="${r.recipe_image||''}" onerror="this.onerror=null;this.src='https://via.placeholder.com/400x240?text=No+Image'">
      <div class="body"><h4 style="margin:0">${r.recipe_name}</h4><p style="margin:6px 0 0 0;color:var(--muted)">${r.recipe_favorite==1? '⭐ Favorit':''}</p>
      <div style="margin-top:8px"><a style="background:var(--accent);color:#043;padding:8px 10px;border-radius:8px;text-decoration:none;font-weight:700" href="detail.html?id=${encodeURIComponent(r.recipe_id)}">Lihat</a></div></div>`;
    container.appendChild(c);
  });
}

document.getElementById('btn').onclick = ()=> {
  const q = document.getElementById('q').value;
  history.replaceState(null,'',`search.html?q=${encodeURIComponent(q)}`);
  doSearch(q);
};
document.getElementById('q').addEventListener('keyup', e=> { if(e.key==='Enter') document.getElementById('btn').click(); });

load();
</script>
</body>
</html>
